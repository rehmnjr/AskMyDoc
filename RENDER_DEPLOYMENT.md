# Render.com Deployment Guide for AskMyDoc

## Overview

This guide provides detailed instructions for deploying the AskMyDoc application on Render.com, addressing common deployment issues, particularly with the Next.js frontend.

## Frontend Deployment Configuration

### Next.js Configuration

The `next.config.ts` file has been updated with the following settings:

```typescript
const nextConfig: NextConfig = {
  output: 'standalone',
  images: {
    domains: ['clerk.com'],
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '**',
      },
    ],
  },
};
```

These settings ensure:

1. **Standalone Output**: Creates a standalone build that includes all dependencies, making it easier to deploy on platforms like Render.com.
2. **Image Optimization**: Configures Next.js to properly handle images from external domains, including Clerk authentication.

### Render.yaml Configuration

The `render.yaml` file has been updated with the correct static publish path:

```yaml
# Frontend Next.js application
- type: web
  name: askmydoc-frontend
  env: node
  plan: free
  buildCommand: cd frontend && npm install && npm run build
  startCommand: cd frontend && node .next/standalone/server.js
  envVars:
    - key: NEXT_PUBLIC_API_URL
      value: https://askmydoc-backend-lr1q.onrender.com
    - key: NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
      sync: false
    - key: CLERK_SECRET_KEY
      sync: false
    - key: NODE_ENV
      value: production
    - key: PORT
      value: 3000
  autoDeploy: true
```

The updated configuration uses the standalone server.js file generated by Next.js when using the `output: 'standalone'` option. This is the recommended approach for deploying Next.js applications on Render.com.

## Deployment Steps

1. **Push Changes to GitHub**
   - Ensure all configuration changes are committed and pushed to your GitHub repository.

2. **Deploy via Render Blueprint**
   - Log in to your Render.com dashboard
   - Navigate to Blueprints
   - Select your repository
   - Render will automatically detect the `render.yaml` file and set up the services

3. **Manual Deployment (Alternative)**
   - Create a new Web Service on Render.com
   - Connect your repository
   - Configure the service using the settings from the `render.yaml` file
   - Make sure to set all required environment variables

4. **Verify Environment Variables**
   - Ensure all required environment variables are set:
     - `NEXT_PUBLIC_API_URL`: URL of your backend service
     - `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`: Your Clerk publishable key
     - `CLERK_SECRET_KEY`: Your Clerk secret key
     - `NODE_ENV`: Set to `production`

5. **Monitor Deployment Logs**
   - After initiating deployment, monitor the logs for any errors
   - Pay special attention to the build process and any Next.js-related warnings or errors

## Troubleshooting Frontend Deployment Issues

### "Not Found" Error

If you're seeing a "Not Found" error on your frontend deployment:

1. **Check Build Output**
   - Review the build logs to ensure the Next.js build completed successfully
   - Verify that the standalone output was generated in the `.next/standalone` directory

2. **Verify Start Command**
   - The start command should be `cd frontend && node .next/standalone/server.js`
   - This runs the standalone server generated by Next.js with the `output: 'standalone'` option

3. **Check Environment Variables**
   - Verify all required environment variables are set correctly:
     - `PORT`: Must be set to `3000` for the standalone server
     - `NODE_ENV`: Should be set to `production`
     - `NEXT_PUBLIC_API_URL`: Must point to your backend service URL
     - Clerk authentication requires both `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` and `CLERK_SECRET_KEY`

4. **Clerk Configuration**
   - Ensure your Clerk application is configured with the correct redirect URLs
   - Add your Render.com frontend URL to the allowed URLs in your Clerk dashboard

5. **Check Next.js Configuration**
   - Verify that `next.config.ts` has `output: 'standalone'` set
   - Ensure the images configuration is properly set up for external domains

### Build Failures

If the build process is failing:

1. **Node.js Version**
   - Render.com uses Node.js 14.17.0 by default
   - If your application requires a newer version, you can specify it in a `.node-version` file

2. **Dependencies**
   - Ensure all dependencies are correctly listed in `package.json`
   - Check for any peer dependency warnings or errors

3. **Build Command**
   - Verify the build command is correctly set to `cd frontend && npm install && npm run build`

## Redeploying After Changes

After making changes to fix deployment issues:

1. Commit and push your changes to GitHub
2. In your Render.com dashboard, navigate to the service
3. Click "Manual Deploy" and select "Clear build cache & deploy"
4. Monitor the deployment logs for any issues

## Additional Resources

- [Render.com Documentation for Node.js Services](https://render.com/docs/deploy-node-express-app)
- [Next.js Deployment Documentation](https://nextjs.org/docs/deployment)
- [Clerk Authentication Documentation](https://clerk.com/docs)